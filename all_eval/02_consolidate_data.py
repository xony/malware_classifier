#!/usr/bin/env python
# encoding: utf-8
#
# For easier access save all the data into three distinct files 

import os, json
from config import *

def consolidate_data(data_files, svmdata_dir): 
    # load all the saved svm data 
    seq_dict = {}
    frq_dict = {}
    bin_dict = {}
    
    for dirname in data_files:
        with open(svmdata_dir + "/" + dirname + "/" + "sequence_vectors", 'r') as infile:
            sequence_vectors = json.load(infile)
        with open(svmdata_dir + "/" + dirname + "/" + "frequency_vectors", 'r') as infile:
            frequency_vectors = json.load(infile)
        with open(svmdata_dir + "/" + dirname + "/" + "binary_vectors", 'r') as infile:
            binary_vectors = json.load(infile)
        seq_dict[dirname] = list(sequence_vectors)
        frq_dict[dirname] = list(frequency_vectors)
        bin_dict[dirname] = list(binary_vectors)

    with open(svmdata_dir + "/" + "sequence_vectors", 'w') as outfile:
        json.dump(seq_dict,outfile,indent=2, separators=(',', ': '))
    with open(svmdata_dir + "/" + "frequency_vectors", 'w') as outfile:
        json.dump(frq_dict,outfile,indent=2, separators=(',', ': '))
    with open(svmdata_dir + "/" + "binary_vectors", 'w') as outfile:
        json.dump(bin_dict,outfile,indent=2, separators=(',', ': '))


if __name__ == '__main__':
    # first get all the directories in the traces dir
    # these will contain the actual trace files and are named according to the apk
    malicious_svm_data = []
    benign_svm_data = []
    for dirname in os.listdir(BENIGN_SVMDATA_DIRECTORY):
        if not "_vectors" in dirname:
            benign_svm_data.append(dirname)

    for dirname in os.listdir(MALICIOUS_SVMDATA_DIRECTORY):
        if not "_vectors" in dirname:
            malicious_svm_data.append(dirname)
    
    consolidate_data(benign_svm_data, BENIGN_SVMDATA_DIRECTORY)
    consolidate_data(malicious_svm_data, MALICIOUS_SVMDATA_DIRECTORY)
